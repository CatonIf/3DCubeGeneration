<!--
	here to take a look at the javascript behind this?
-->
<style>
	#arab {
		text-align: center;
		font-size: 100px;
	}

	#input, #ipa, #dial {
		width: 100%;
		font-size: 75px;
		font-family: 'Times New Roman', Times, serif;
		text-align: center;
	}

	.red {
		color: red;
	}
</style>

<script>

function arab_convert(input) {
	return input
		.toLowerCase()
		.replace(/\[.+?\]|[^uiaptkbdglnh' !¡?¿]/g, '*')
		.replace(/u/g, '٥')
		.replace(/i/g, '۱')
		.replace(/a/g, '۰')
		.replace(/p/g, '۹')
		.replace(/t/g, '۷')
		.replace(/k/g, '۲')
		.replace(/b/g, '۴')
		.replace(/d/g, '۸')
		.replace(/g/g, '٦')
		.replace(/n/g, '۶')
		.replace(/l/g, '٤')
		.replace(/h/g, '٫')
		.replace(/'/g, '،')
		.replace(/(?<=\s|[!]|^)٥/g, '‎٥')
		.replace(/(?<=\s|[!]|^)٦/g, '‎٦')
		.replace(/(?<=\s|[!]|^)٤/g, '‎٤')
		.replace(/ /g, ' ')
}


const occl = { 'p': 'b', 't': 'd', 'k': 'g' }

const nasu = { 'b': 'm', 'd': 'N', 'g': 'ŋ' }
const fric = { 'b': 'ɸ', 'd': 's', 'g': 'x' }
const sonu = { 'b': 'β', 'd': 'z', 'g': 'ɣ' }
const shrt = { 'u': 'o', 'i': 'e', 'a': 'ə'}

const pal = {
	'k': 'c', 'g': 'ɟ',
	'x': 'ç', 'ɣ': 'ʝ',
	's': 'ɕ', 'z': 'ʑ',
	'ŋ': 'ɲ'
}

/* ALPHABET

| labia | denti | gutur | conti |
|   P   |   T   |   K   |       |
|   B   |   D   |   G   |   N   |
|   U   |   I   |   A   |   L   |

*/

ipa_convert = function (input) {
	return input

		.replace(/[¿?!¡]/g, '')

		.replace(/\[.+?\]/g, '*')

		.toLowerCase()

		.replace(/  +/g, ' ')

		.replace(/[ptk][ptk][ptk]+/g, '*')

		.replace(/[^uiaptkbdglnh' ]/g, '*')

		.replace(/(?<=[uia])h(?=[uia])/g, 'ʔ')
		.replace(/(?<=[uia][' ])(?=[uia])/g, 'ʔ')

		.replace(/(?<=[uia])(?='[ptk][uia])/g, 'ː')
		.replace(/(?<=[uia])h(?=[ptk]([uia ]|$))/g, 'ː')
		.replace(/h/g, '*')

		.replace(/[uia][uia][uia]+/g, '*')

		.replace(/([uia])([uia])/g, yo => {
			if (yo[0] == yo[1]) return '*'; //yo[0].toLowerCase();
			return yo.toLowerCase().replace(/i/g, 'j').replace(/(?<=a)u|u(?=a)/g, 'w');
		})
		
		.replace(/(?<=[au])([wj])ː/g, 'ː$1')

		.replace(/(?<=[ptk])[bdg]/g, yo => fric[yo])
		.replace(/[ptk]'?(?=[ptk])/g, yo => fric[occl[yo]])
		.replace(/[bdg](?=[bdg])/g, yo => sonu[yo])

		.replace(/(?<![uwijaː])l/g, '*')

		.replace(/n([bdg])/g, yo => (nasu[yo[1]] + yo[1].toLowerCase()))
		.replace(/n([ptk])/g, yo => (nasu[occl[yo[1]]] + yo[1]))
		.replace(/([ptk])n/g, yo => nasu[occl[yo[0]]])

		.replace(/n/g, '*').replace(/N/g, 'n')

		.replace(/(?<![ptk]) (.)/g, ' $1ː')

		.replace(/'/g, 'ˈ').replace(/g/g, 'ɡ')

}

ipa_dialect = function(input) {
	return input
	
		.replace(/ˈ/g, '\'').replace(/ɡ/g, 'g')

		.replace(/(?<![ɸsx])pɸ/g, 'ɸ')
		.replace(/(?<![ɸsx])ts/g, 's')
		.replace(/(?<![ɸsx])kx/g, 'x')

		.replace(/(?<![βzɣnmŋ])[bdg]/g, yo => sonu[yo])

		.replace(/β(?=w)/g, 'v')
		.replace(/ɸ(?=w)/g, 'f')
		
		.replace(/([kgxɣszŋ])'?(j|(?=i))/g, yo => pal[yo[0]])
		.replace(/ŋ(?=[cɟçʝ])/g, 'ɲ')
		
		.replace(/β([bdgɟ])/g, yo => yo[1]+'ː')

		.replace(/aj/g, 'ɛ')
		.replace(/aw/g, 'ɔ')
		.replace(/uj/g, 'y')
		.replace(/([ui])(?!ː)/g, yo => shrt[yo])
		.replace(/(?<=[ui])ː/g, '')
		.replace(/(?<=a)ː(?=[wj])/g, '')

		.replace(/(?<=[iɛy])([sx])(?='?[ptkcmnŋ])/g, yo => pal[yo[0]])
		.replace(/(?<=[iɛy])([zɣ])(?='?[bdg])/g, yo => pal[yo[0]])

		.replace(/s'?(?=[pk])/g, 'ʃ')
		.replace(/z'?(?=[bg])/g, 'ʒ')

		.replace(/'/g, 'ˈ').replace(/g/g, 'ɡ')

}

function render(id, content) {
	let span = document.getElementById(id);
	span.innerHTML = content.replace(/(\*+)/g, '<span class="red">$1</span>');
	return content;
}

function update(input) {

	render('arab', arab_convert(input));
	render('dial', ipa_dialect(render('ipa', ipa_convert(input))));
}
</script>
<span>Knuk Orthography to IPA by Catoni</span>
<input type="text" oninput="update(this.value)" id="input"></input>
<p id="arab"></p>
<p id="ipa"></p>
<p id="dial"></p>